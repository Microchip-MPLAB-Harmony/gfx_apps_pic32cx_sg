<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <link rel="shortcut icon" href="../../../../favicon.ico" type="image/x-icon"> <link rel="stylesheet" href="../../../../assets/css/just-the-docs-default.css"> <script async src="https://www.googletagmanager.com/gtag/js?id=UA-2724382-16"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-2724382-16'); </script> <script type="text/javascript" src="../../../../assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="../../../../assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.8.0 --> <title>MPLAB® Harmony 3 Graphics Application Examples for PIC32CX SG41/61 Family | Harmony 3 Graphics Application Examples for PIC32CX SG41/61 Family Package</title> <meta name="generator" content="Jekyll v3.9.3" /> <meta property="og:title" content="MPLAB® Harmony 3 Graphics Application Examples for PIC32CX SG41/61 Family" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Harmony 3 Graphics Application Examples for PIC32CX SG41/61 Family Package" /> <meta property="og:description" content="Harmony 3 Graphics Application Examples for PIC32CX SG41/61 Family Package" /> <link rel="canonical" href="../../../../apps/legato_ext_res/firmware/legato_ext_res_cx_sg41_cu_mxt_cpro_spi.X/" /> <meta property="og:url" content="../../../../apps/legato_ext_res/firmware/legato_ext_res_cx_sg41_cu_mxt_cpro_spi.X/" /> <meta property="og:site_name" content="MPLAB® Harmony 3 Graphics Application Examples for PIC32CX SG41/61 Family" /> <meta property="og:type" content="website" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="MPLAB® Harmony 3 Graphics Application Examples for PIC32CX SG41/61 Family" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"WebPage","description":"Harmony 3 Graphics Application Examples for PIC32CX SG41/61 Family Package","headline":"MPLAB® Harmony 3 Graphics Application Examples for PIC32CX SG41/61 Family","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"../../../../assets/images/vendor/mhgs_logo_transparent.png"}},"url":"../../../../apps/legato_ext_res/firmware/legato_ext_res_cx_sg41_cu_mxt_cpro_spi.X/"}</script> <!-- End Jekyll SEO tag --> </head> <body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header"> <a href="../../../../index.html" class="site-title lh-tight"> <div class="site-logo"></div> </a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a> </div> <nav role="navigation" aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><a href="../../../../" class="nav-list-link">Harmony 3 Graphics PIC32CX SG41/61 Applications Package</a></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="../../../../apps/readme.html" class="nav-list-link">Example Applications</a><ul class="nav-list "><li class="nav-list-item "><a href="../../../../apps/legato_quickstart/" class="nav-list-link">Legato Quickstart</a></li><li class="nav-list-item "><a href="../../../../apps/legato_adventure/" class="nav-list-link">Legato Adventure</a></li><li class="nav-list-item "><a href="../../../../apps/legato_ext_res/" class="nav-list-link">Legato External Resources</a></li><li class="nav-list-item "><a href="../../../../apps/blank_quickstart/" class="nav-list-link">Blank Quickstart</a></li></ul></li><li class="nav-list-item"><a href="../../../../release_notes.html" class="nav-list-link">Release notes</a></li><li class="nav-list-item"><a href="../../../../mplab_harmony_license.html" class="nav-list-link">License</a></li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/pmarsceill/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search MPLAB® Harmony 3 Graphics Application Examples for PIC32CX SG41/61 Family" aria-label="Search MPLAB® Harmony 3 Graphics Application Examples for PIC32CX SG41/61 Family" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> <nav aria-label="Auxiliary" class="aux-nav"> <ul class="aux-nav-list"> <li class="aux-nav-list-item"> <a href="https://support.microchip.com" class="site-button" > Obtain Support from Microchip </a> </li> </ul> </nav> </div> <div id="main-content-wrap" class="main-content-wrap"> <div id="main-content" class="main-content" role="main"> <p><img src="../../../../images/mhgs.png" alt="" /> legato_ext_res_cx_sg41_cu_mxt_cpro_spi.X</p> <h2 id="defining-the-architecture"> <a href="#defining-the-architecture" aria-labelledby="defining-the-architecture" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Defining the Architecture </h2> <p><img src="../../../../images/legato_ext_res_pic32cx_sg41_cu_mxt_cpro_spi_arch.png" alt="" /></p> <p>The legato_ext_res application uses the built-in USB peripheral on the PIC32CX SG41 Curiosity Ultra board and configures the Target USB port on the development kit to work as a serial port by using the MPLAB Harmony 3 USB Device Stack.</p> <p>This serial connection is used to transfer and program a binary (.bin) file which contains graphics resources (images and font glyphs) into the external non-volatile SQI Flash.</p> <p>This configuration runs on the PIC32CX SG41 Curiosity Ultra Development Kit with a maXTouch® Curiosity Pro Board. The Legato Graphics Library is used to render graphics to the display.</p> <p>The application populates some of its widgets from assets stored on on-chip NVM and other parts of it, from assets stored on a non-volatile QSPI flash memory through the <strong>Setup</strong> mode provided in the application.</p> <p>The USB peripheral receives a file named <strong>SQI.bin</strong> through a USB connection to a PC via a serial terminal program client (TeraTerm). The application reads this binary file and writes it to external non-volatile memory via the SQI peripheral.</p> <h3 id="demonstration-features"> <a href="#demonstration-features" aria-labelledby="demonstration-features" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Demonstration Features </h3> <ul> <li>Legato Graphics Library</li> <li>ILI9488 display controller driver</li> <li>4-line SPI display interface driver</li> <li>Time system service, timer-counter peripheral library and driver</li> <li>16-bit RGB565 color depth support (65535 unique colors)</li> <li>Port, I2C peripheral library</li> <li>QSPI peripheral library</li> <li>USB Full Speed driver</li> <li>Images and Fonts for user interface stored in internal and external NVM memory</li> </ul> <h2 id="creating-the-project-graph"> <a href="#creating-the-project-graph" aria-labelledby="creating-the-project-graph" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Creating the Project Graph </h2> <p><img src="../../../../images/legato_ext_res_cx_sg41_cu_mxt_cpro_spi_pg.png" alt="" /></p> <p>The Project Graph diagram shows the Harmony components that are included in this application. Lines between components are drawn to satisfy components that depend on a capability that another component provides.</p> <p>Adding the <strong>PIC32CX SG41 Curiosity Ultra BSP</strong> and <strong>Legato Graphics w/ MXT Curiosity Pro Display</strong> Graphics Template component into the project graph will automatically add the components needed for a graphics project and resolve their dependencies. It will also configure the pins needed to drive the external peripherals like the display and the touch controller.</p> <p>Additional components to support USB, SQI, I2C and SERCOM Driver needs to be added and connected manually.</p> <p><strong>Note: Replace the existing display driver LE ILI9488 with LE External Controller. For SQI Flash access, make sure all 6 pins for QSPI is mapped.</strong></p> <h2 id="configuring-assets-for-external-storage"> <a href="#configuring-assets-for-external-storage" aria-labelledby="configuring-assets-for-external-storage" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <strong>Configuring Assets for External Storage</strong> </h2> <h2 id="asset-streaming-interfaces"> <a href="#asset-streaming-interfaces" aria-labelledby="asset-streaming-interfaces" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Asset Streaming Interfaces </h2> <p>To support external assets, in MPLAB® Harmony Graphics Composer under ‘Project -&gt; Project Settings -&gt; Library’, enable ‘Streaming Interface’.</p> <p><img src="../../../../images/legato_ext_res_Library_settings.png" alt="" /></p> <p>The Legato Graphics Library generated code will call to the external asset streaming interfaces:</p> <p><strong>leResult leApplication_MediaOpenRequest</strong></p> <p><strong>leResult leApplication_MediaReadRequest</strong></p> <p><strong>void leApplication_MediaCloseRequest</strong></p> <p>These interfaces must be implemented in application code for to route asset data from the external storage medium into the Legato Graphics Library.</p> <h2 id="external-asset-storage-locations"> <a href="#external-asset-storage-locations" aria-labelledby="external-asset-storage-locations" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> External Asset Storage Locations </h2> <p>Memory locations are configured in MPLAB® Harmony Graphics Composer under ‘Project -&gt; Memory Locations’.</p> <p>The location ‘SQI’ is configured to create a binary file called ‘SQI.bin’. All assets assigned to this location will be generated in RAW binary format as part of this file.</p> <p><img src="../../../../images/legato_ext_res_AssetLocations.png" alt="" /></p> <p>The following assets are assigned to this location:</p> <p>1) One RAW Image</p> <p><img src="../../../../images/legato_ext_res_ImageRaw.png" alt="" /></p> <p>2) One JPEG Image</p> <p><img src="../../../../images/legato_ext_res_ImageJPEG.png" alt="" /></p> <p>3) One Palette Compressed Image</p> <p><img src="../../../../images/legato_ext_res_ImagePC.png" alt="" /></p> <p>4) One Noto-Sans CJK font including custom CJK Unified Ideographs font range</p> <p><img src="../../../../images/legato_ext_res_ChineseFont.png" alt="" /></p> <p><strong>Note:</strong> PNG image and RLE Image is excluded in this demo since, a larger allocation of variable heap is essential for PNG and RLE decoding to operate.</p> <h2 id="application-code-implementation"> <a href="#application-code-implementation" aria-labelledby="application-code-implementation" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Application Code Implementation </h2> <p>Here is the pseudo code explanation of how the application code is implemented in <a href="../src/app.c">app.c</a>.</p> <p>On launch, the application renders the default screen. As the Legato Graphics Library draws the default screen, it will call the streaming interfaces as needed.</p> <p><strong>leResult leApplication_MediaOpenRequest</strong> is implemented to operate the stream in blocking mode and to wait until transfer status gets completed.</p> <p><strong>leResult leApplication_MediaReadRequest</strong> is implemented to read data from the QSPI Flash based on address and size requested by the Legato Graphics Library.</p> <p><strong>void leApplication_MediaCloseRequest</strong> is empty in this example, but can be used to close the driver if needed.</p> <p><strong>event_default_LogoButton_OnReleased</strong> button release event is implemented to toggle between English and Chinese.</p> <p><strong>event_default_SloganButton_OnReleased</strong> button release event is implemented to cycle images and strings from 8bit LUT Palette, RAW and JPEG. These assets are stored in the external QSPI Flash.</p> <h2 id="memory-management-settings"> <a href="#memory-management-settings" aria-labelledby="memory-management-settings" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Memory Management Settings </h2> <p>There are several memory settings that are non-default in this application. These settings were derived on trial-and-error basis with visual observation of the applications graphics draw performance.</p> <p>The following window is the Library tab in Project Settings in MPLAB® Harmony Graphics Composer:</p> <p><img src="../../../../images/legato_ext_res_Library_settings.png" alt="" /></p> <p>JPEG Decoder Cache Size is increased to 2048 bytes. This sets the size of the memory cache in JPEG Decoder streaming interface. On first request for pixel, the interface pre-fetches this amount from the JPEG image file. This improves JPEG pixel draw speed. Note that for maximum efficiency, the setting value should be divisble by the default file system block size, typically 512 bytes.</p> <p>Font Cache Size is increased to 4096 bytes. This sets the size of the memory cache in Font streaming interface. It must be able to hold the largest rasterized glyph in the design.</p> <p>The following window is the Memory tab in Project Settings in MPLAB® Harmony Graphics Composer:</p> <p><img src="../../../../images/legato_ext_res_Memorysettings.png" alt="" /></p> <p>The majority of Legato Graphics Library’s normal operation utilizes memory from the fixed memory pool. The pool sizes are default to the best optimal settings based-on simulation during development of the library.</p> <p>The following window is the Renderer tab in Project Settings in MPLAB® Harmony Graphics Composer:</p> <p><img src="../../../../images/legato_ext_res_Renderersettings.png" alt="" /></p> <p>The scratch buffer size is set to 12 Kilobytes. This setting is based on the guide lines for Scratch Buffer settings on the Graphics Wiki <a href="https://github.com/mchpgfx/legato.docs/wiki/Adjusting-Scratch-Buffer-Size">https://github.com/mchpgfx/legato.docs/wiki/Adjusting-Scratch-Buffer-Size</a>.</p> <h2 id="building-the-application"> <a href="#building-the-application" aria-labelledby="building-the-application" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Building the Application </h2> <p>The parent directory for this application is apps/legato_ext_res. To build this application, use MPLAB X IDE to open the apps/legato_ext_res/firmware/legato_ext_res_cx_sg41_cu_mxt_cpro_spi.X project file.</p> <p>The following table lists configuration properties:</p> <div class="table-wrapper"><table> <thead> <tr> <th>Project Name</th> <th>BSP Used</th> <th>Graphics Template Used</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td>legato_ext_res_cx_sg41_cu_mxt_cpro_spi.X</td> <td>PIC32CX SG41 Curiosity Ultra BSP</td> <td>Legato graphics w/ maXTouch Curiosity Pro Display</td> <td>PIC32CX SG41 Curiosity Ultra w/ maXTouch Curiosity Pro display via SPI interface</td> </tr> </tbody> </table></div> <blockquote> <p>**_NOTE:_** This application may contain custom code that is marked by the comments // START OF CUSTOM CODE … and // END OF CUSTOM CODE. When using the MPLAB Harmony Configurator to regenerate the application code, use the “ALL” merging strategy and do not remove or replace the custom code.</p> </blockquote> <h2 id="configuring-the-hardware"> <a href="#configuring-the-hardware" aria-labelledby="configuring-the-hardware" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Configuring the Hardware </h2> <p>The final setup should be:</p> <p><img src="../../../../images/legato_quickstarts_pic32cx_sg41_cu_mxt_cpro_spi_conf.png" alt="" /></p> <p>Set the IM switches on the MXT Curiosity Pro Display to IM[2:0] = 111b.</p> <p><img src="../../../../images/legato_qs_e54_cult_cpro_spi_conf2.png" alt="" /></p> <p><strong>Note: Connect the USB cable to the **Target USB</strong> port from the PC. This can be connected before or at any point after the application is powered-on.</p> <h2 id="running-the-demonstration"> <a href="#running-the-demonstration" aria-labelledby="running-the-demonstration" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Running the Demonstration </h2> <p>When power-on is successful, the demonstration will populate the screen with 2 buttons <strong>Setup</strong> and <strong>Application</strong>:</p> <p><img src="../../../../images/IntroScreen.png" alt="" /></p> <p>If a valid USB connection is made to PC and configured, the LED2 (orange) will light up.</p> <p>Press and release the <strong>Setup</strong> button to go to the Setup screen.</p> <p><img src="../../../../images/SetupScreen.png" alt="" /></p> <p>If the data transfer to QSPI is successfully verified, the LED1 will light up.</p> <p><strong>Note: When there is an issue in establishing the USB connection, LED1 toggles.</strong><br /> <strong>Note: Similarly, When QSPI data transfer fails during verification, LED2 toggles.</strong></p> <p>Press and release the <strong>Erase &amp; Update SQI Flash</strong> button on-screen. Next press and release the <strong>Yes</strong> button. The application will wait for the the data transfer from the PC on release of the button.</p> <p>Next, use your favorite Terminal program on the PC and open a <strong>new connection</strong>.</p> <p><img src="../../../../images/NewConnection.png" alt="" /></p> <p>The asset binary should be in the file <strong>.legato_generate_cache.zip</strong>, inside the project’s config folder: apps\legato_ext_res\firmware\src\config\lcc_rgb565_mxt_ck_cu\.legato_generate_cache.zip\SQI.bin</p> <p>Extract the .zip archive to a folder of your choosing and send the file named <strong>SQI.bin</strong> from the PC to the device using the terminal.</p> <p>Now send file <strong>SQI.bin</strong> using the Terminal program from the PC.</p> <p>LED1, on lower left side of the Curiosity board in the picture, will Light up when the file is flashing successfully. It will then display a downloading progress to indicate the transfer.</p> <p>Once the transfer is complete, press the <strong>Update SQI Flash</strong> button and wait until you see the message “<strong>update complete</strong>”.</p> <p>You can then press the <strong>Restart Application</strong> button to return back to the introduction screen and start the demo by pressing the <strong>Application</strong> button.</p> <p><img src="../../../../images/IntroScreen.png" alt="" /></p> <p>Press and release the application button.</p> <p><img src="../../../../images/ApplicationScreen.png" alt="" /></p> <p>Pressing the button will cause the application to load a new image. The image cycles in order from Palette Compressed to Uncompressed RAW with Direct Blit, Uncompressed RAW to JPEG.</p> <p>The MPLAB Harmony Graphics Suite logo is also a button. Pressing the logo will toggle the application between English and Simplified Chinese.</p> <p><img src="../../../../images/legato_quickstart_ext_res_chinese.png" alt="" /></p> <p>Note that all images and glyphs are retrieved from the external SQI Flash.</p> <p>The application is purposely setup in single-buffer configuration to allow the visual inspection of the data retrieval speed when loading the various images and glyphs.</p> <hr /> <hr> <footer> <p class="text-small text-grey-dk-000 mb-0"><img src='https://raw.githubusercontent.com/wiki/Microchip-MPLAB-Harmony/Microchip-MPLAB-Harmony.github.io/images/microchip_logo.png' /><br />Copyright &copy; 2023 Microchip Technology.</p> <!-- <p class="text-small text-grey-dk-000 mb-0"><img src='../../../../assets/images/vendor/microchip_logo.png' /><br /> Copyright &copy; 2024 Microchip Technology.</p> --> </footer> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
